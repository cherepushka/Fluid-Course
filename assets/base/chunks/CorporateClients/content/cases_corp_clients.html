{if $_modx->resource.case_corp_clients !== null}

{set $rows = json_decode($_modx->resource.case_corp_clients, true)}
{set $countCases = count($rows)}
<section class="py-5 mb-sm-5 big-padding">
  <div class="container-xxl">
    <div class="reviews px-xxl-0 px-xl-lg-5 position-relative">
      <h2 class="mb-4">Наши кейсы</h2>

      <div class="d-flex flex-xl-lg-row flex-column">
        <button class="carousel-control-prev d-xl-lg-flex d-none" type="button" data-bs-target="#reviews"
          data-bs-slide="prev">
          <img src="/images/chevron_left.png" alt="">
        </button>
        <div id="reviews" class="carousel slide p-sm-3 p-1 p-md-0 carousel-cases-corp-clients">
          <div class="carousel-inner carousel-inner-cases-corp-clients">

            {foreach $rows as $row index=$index}
            {if $index === 0}

            <!-- 1й активный кейс -->
            <div class="carousel-item active">
              <div class="row comments">
                <!-- Left block -->
                <h5 class="d-sm-none d-block p-0 mb-3">{$row.title}</h5>
                <div class="cases-corp-clients-left-block">
                  <div class="d-flex flex-xl-lg-column flex-row justify-content-xl-lg-between">
                    <div class="d-flex">
                      <img class="w-100" src={$row.img} alt="" />
                    </div>
                    <!-- <img class="" src="/images/case-gazprom-corp-clients.png" alt="" /> -->
                    <div class="d-flex flex-column justify-content-between ms-4 ms-xl-lg-0">
                      <h5 class="d-sm-block d-none my-lg-3 m-0">{$row.title}</h5>
                      <!-- Вертикальная кнопка -->
                      <button
                        class="d-xl-lg-none d-lg-flex d-none justify-content-center align-items-center btn btn-primary py-2 thanks-btn">
                        Благодарность
                      </button>
                    </div>
                  </div>
                  <!-- Горизонтальная кнопка -->
                  <button
                    class="d-xl-lg-flex d-none justify-content-center align-items-center btn btn-primary py-2 mt-4 thanks-btn">
                    Благодарность
                  </button>
                </div>

                <!-- Right block -->
                <div class="cases-corp-clients-right-block">
                  {set $lists = $row.name_list_corp_clients | fromJSON}
                  {foreach $lists as $list}
                  <div class="d-flex flex-column list-cases">
                    <p style="color: #ff5500;font-weight: bold;">{$list.name_of_list_corp_clients}</p>
                    <ul class="case-list m-0">

                      {set $points = $list.point_of_list | fromJSON}
                      {foreach $points as $point}
                      <li>
                        <h4>{$point.point_of_list}</h4>
                      </li>
                      {/foreach}
                    </ul>
                  </div>
                  {/foreach}

                </div>

                <!-- Ниже 992px кнопка -->
                <div class="">
                  <button
                    class="d-flex d-lg-none justify-content-center align-items-center btn btn-primary py-2 mt-5 thanks-btn">
                    Благодарность
                  </button>
                </div>

              </div>
            </div>
            {set $index += 1}

            {else}

            <!-- 2й скрытый кейс -->
            <div class="carousel-item ">
              <div class="row comments">
                <!-- Left block -->
                <h5 class="d-sm-none d-block p-0 mb-3">{$row.title}</h5>
                <div class="cases-corp-clients-left-block">
                  <div class="d-flex flex-xl-lg-column flex-row justify-content-xl-lg-between">
                    <div class="d-flex">
                      <img class="w-100" src={$row.img} alt="" />
                    </div>
                    <!-- <img class="" src="/images/case-gazprom-corp-clients.png" alt="" /> -->
                    <div class="d-flex flex-column justify-content-between ms-4 ms-xl-lg-0">
                      <h5 class="d-sm-block d-none my-lg-3 m-0">{$row.title}</h5>
                      <!-- Вертикальная кнопка -->
                      <button
                        class="d-xl-lg-none d-lg-flex d-none justify-content-center align-items-center btn btn-primary py-2 thanks-btn">
                        Благодарность
                      </button>
                    </div>
                  </div>
                  <!-- Горизонтальная кнопка -->
                  <button
                    class="d-xl-lg-flex d-none justify-content-center align-items-center btn btn-primary py-2 mt-4 thanks-btn">
                    Благодарность
                  </button>
                </div>

                <!-- Right block -->
                <div class="cases-corp-clients-right-block">
                  {set $lists = $row.name_list_corp_clients | fromJSON}
                  {foreach $lists as $list}
                  <div class="d-flex flex-column list-cases">
                    <p style="color: #ff5500;font-weight: bold;">{$list.name_of_list_corp_clients}</p>
                    <ul class="case-list m-0">

                      {set $points = $list.point_of_list | fromJSON}
                      {foreach $points as $point}
                      <li>
                        <h4>{$point.point_of_list}</h4>
                      </li>
                      {/foreach}
                    </ul>
                  </div>
                  {/foreach}

                </div>

                <!-- Ниже 992px кнопка -->
                <div class="">
                  <button
                    class="d-flex d-lg-none justify-content-center align-items-center btn btn-primary py-2 mt-5 thanks-btn">
                    Благодарность
                  </button>
                </div>

              </div>
            </div>

            {/if}
            {/foreach}

          </div>

        </div>

        <button class="carousel-control-next  d-xl-lg-flex d-none" type="button" data-bs-target="#reviews"
          data-bs-slide="next">
          <img src="/images/chevron_right.png" alt="">
        </button>

        <!-- Кнопки переключения ниже 1140px -->
        <div class="d-xl-lg-none d-flex justify-content-center mt-3">
          <button class="border-0 bg-transparent btn-case" type="button" data-bs-target="#reviews" data-bs-slide="prev">
            <img style="width: 45px; height: 45px;" src="/images/chevron_left.png" alt="">
          </button>
          <!-- <div class="d-xl-lg-none d-flex align-items-center mx-3 " style="font-size: 14px;"><span
            class="number-case"></span> / {$countCases}</div> -->
          <button class="border-0 bg-transparent btn-case" type="button" data-bs-target="#reviews" data-bs-slide="next">
            <img style="width: 45px; height: 45px;" src="/images/chevron_right.png" alt="">
          </button>
        </div>
      </div>

    </div>
  </div>
  </div>
</section>
{/if}

<!-- Скрипт для отображения количества кейсов на странице Условия для Корпоративных клиентов сколько из скольки -->
<script defer>
  let numberCase = document.querySelector('.number-case');
  let btnCase = document.querySelectorAll('.btn-case');
  let cases = document.querySelectorAll('.carousel-item');

  numberCase.innerHTML = 1 + ' ';

  btnCase.forEach(el => {
    el.addEventListener("click", () => {
      let activeCase = document.querySelector('.carousel-item .active');
      console.log(activeCase);
      cases.forEach((el, index) => {
        let cases = document.querySelectorAll('.carousel-item');
        if (el.classList.contains("active")) {
          let number = index + 1;
          numberCase.innerHTML = number + ' ';
          // console.log(index)
          // console.log(el)
          // console.log(cases)
        }
      })
    })
  })
  console.log(cases)

</script>