<div class="container-xxl my-5">

  <!-- ИТОГОВАЯ РАБОТА -->
  <div class="row align-items-center justify-content-lg-start">
    <div class="final_work_describe col-lg-6">
      {set $rows = json_decode($_modx->resource.final_work,true)}
      {foreach $rows as $row}
      <h2>{$row.title}</h2>
      <div>
        <h6>{$row.subtitle}</h6>
        {set $points = $row.points | fromJSON}
        <ul>
          {foreach $points as $point}
          <li>
            <h6>{$point.point}</h6>
          </li>
          {/foreach}
        </ul>
      </div>
    </div>
    <div class="col-lg-4">
      <img class="w-100" src={$row.img} alt="Графика курса">
    </div>
    {/foreach}
  </div>


  <!-- КАК ПРОХОДИТ ОБУЧЕНИЕ -->
  <div class="my-5">
    <h2>
      Как проходит обучение
    </h2>
    <ol class="row list-unstyled my-4">
      {set $rows = json_decode($_modx->resource.final_work_template_migx, true)}
      {set $i = 1}
      {foreach $rows as $row}
      <li class="final_work_stage col-lg-3 col-md-6">
        <h1 class="my-4" style="font-size: 62px;">0{$i}</h1>
        <h6>{$row.describe}</h6>
      </li>
      {set $i += 1}
      {/foreach}
    </ol>
  </div>


  <!-- ОТЗЫВЫ -->
  <div class="student_reviews">

    {if $_modx->resource.hideComments?}{else}
    <h2>
      Отзывы студентов
    </h2>
    <div class="d-flex">
      <button class="carousel-control-prev"><img src="/images/chevron_left.png" alt=""></button>
      <div id="reviews" class="carousel slide my-4 overflow-auto">
        <div class="coments">
          <!-- <button class="carousel-control-prev" type="button"></button> -->
          <div class="box">
            {set $rows = json_decode($_modx->resource.comments_migx, true)}
            {foreach $rows as $row}
            <client-coment client="{$row.client}" text="{$row.comment_text}"></client-coment>
            {/foreach}
          </div>

        </div>
      </div>

      <button class="carousel-control-next"><img src="/images/chevron_right.png" alt=""></button>
    </div>
    {/if}
  </div>

</div>

{if $_modx->resource.lesson_recording?}
<!-- ЗАПИСЬ ОДНОГО УРОКА -->
{set $row = json_decode($_modx->resource.lesson_recording, true)}
<div class="container-xxl mb-5">
  <h2 class="mb-5">Получите запись одного урока</h2>
  <div class="row">
    <div class="col-lg-4">
      <h4 style="color: #4763D5;font-size: 22px;font-weight: normal;">{$row.0.title}</h4>
      <p class="mt-3" style="font-size: 18px;">{$row.0.subtitle}</p>
    </div>
    <div class="col-lg-4">
      <span style="font-size: 18px;">{$row.0.description}</span>
    </div>
    [[!AjaxForm?
    &snippet=`FormIt`
    &hooks=`FormItSaveForm,email`
    &emailSubject=`От FluidCourse`
    &emailTo=`[[+email]]`
    &emailTpl=`tpl_one_lesson_email`
    &emailFrom=`[[++emailsender]]`
    &emailFromName=`Бесплатный урок от FluidCourse`
    &form=`tpl_one_lesson`
    &formName=`Запись одного урока [[*pagetitle]]`
    &formFields=`
    name_and_surname,
    email
    `
    &fieldNames=`
    name_and_surname==Имя,
    email==Электронная почта,
    `
    &validate=`
    name_and_surname:required:minLength=^3^,
    email:required:email,
    workemail:blank
    `
    &successMessage=`Поздравляем с успешной регистрацией!`
    &validationErrorMessage=`Неправильно заполнена форма!`
    ]]

  </div>
</div>
{/if}

<!-- ШАГИ РЕГИСТРАЦИИ -->
{$_modx->getChunk('steps_for_reg')}


<!-- ФОРМЫ ЗАПИСИ -->
<div class="container-xxl my-5">
  {if $_modx->resource.hideForm?}{else}
  <div id="enroll-form" class="d-flex flex-md-row flex-column justify-content-evenly gy-4 gap-4 position-relative">
    <!-- Информация слева от формы -->
    <div class="col-md-6 describe_near_form">
      [[*describe_near_form_reg]]
      {if $_modx->resource.total_price?}<h1 style="font-size: 40px;">{$_modx->resource.total_price} руб.</h1>{/if}
      <div class="row">
        {if $_modx->resource.monthly_price?}
        <div class="col-lg-7 col" style="line-height: 24px;">
          <span style="color: #4763D5;">Купить в рассрочку</span> <br>
          <span class="text-white">от {$_modx->resource.monthly_price} руб/ месяц</span>
        </div>
        {/if}
        <button
          class="col-lg-5 col mt-lg-0 mt-2 btn btn-secondary">Подробнее</button>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


    {if $_modx->resource.change_forms_buy_or_reg?}

    [[!AjaxForm?
    &snippet=`FormIt`
    &hooks=`FormItSaveForm,email{if $_modx->resource.teachBase_session_id?},teachbaseReg{/if}`
    &emailSubject=`От FluidCourse`
    &emailTo=`[[+email]]`
    &emailTpl=`tpl_email`
    &emailFrom=`[[++emailsender]]`
    &emailFromName=`FluidCourse.ru`
    &form=`tpl_enroll_form`
    &formName=`[[*pagetitle]]`
    &formFields=`
    name_and_surname,
    email,
    phone,
    company,
    job,
    promocode,
    personal-data,
    mailing`
    &fieldNames=`
    name_and_surname==Имя,
    email==Электронная почта,
    phone==Телефон,
    company==Организация,
    job==Должность,
    promocode==Промокод
    personal-data==Согласие на обработку персональных данных,
    mailing==Согласие на получение SMS и Email рассылок`
    &validate=`
    name_and_surname:required:minLength=^3^,
    email:required:email,
    phone:required:regexp=^/^\+7 \([0-9][0-9][0-9]\) [0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]/^,
    company:required:minLength=^3^,
    job:required:minLength=^3^,
    {if $_modx->resource.required_promo?}promocode:required:regexp=^/fcng2023|[[*promocode]]/iu^,{else}{/if}
    workemail:blank
    `
    &successMessage=`Поздравляем с успешной регистрацией!`
    &validationErrorMessage=`Неправильно заполнена форма!`
    ]]


    {else}

    [[!AjaxForm?
    &snippet=`FormIt`
    &hooks=`FormItSaveForm,email{if $_modx->resource.teachBase_session_id?},teachbaseReg{/if}`
    &emailSubject=`От FluidCourse`
    &emailTo=`[[+email]]`
    &emailFrom=`[[++emailsender]]`
    &emailFromName=`FluidCourse.ru`
    &emailTpl=`tpl_email`
    &form=`tpl_enroll_optional_promo`
    &formName=`[[*pagetitle]]`
    &formFields=`
    name_and_surname,
    email,
    phone,
    promocode,
    personal_data,
    mailing`
    &fieldNames=`
    name_and_surname==Имя,
    email==Электронная почта,
    phone==Телефон,
    promocode==Промокод
    personal_data==Согласие на обработку персональных данных,
    mailing==Согласие на получение SMS и Email рассылок`
    &validate=`
    name_and_surname:required:minLength=^3^,
    email:required:email,
    phone:required:regexp=^/^\+7 \([0-9][0-9][0-9]\) [0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]/^,
    {if $_modx->resource.required_promo?}promocode:required:regexp=^/fcng2023|[[*promocode]]/iu^,{else}{/if}
    workemail:blank
    `
    &successMessage=``
    &validationErrorMessage=`Неправильно заполнена форма!`
    ]]

    {/if}
    <!-- </div> -->
  </div>
  {/if}
  <!-- Скрипт отвечает за уведомление об успешном заполнении формы -->
  <script type="application/javascript">

    const successBag = $('.ajax_form .apply-form__success');
    const errorBag = $('.ajax_form .apply-form__errors');

    $(document).on('submit', '.ajax_form', function (event) {
      successBag.html('')
      errorBag.html('')

      successBag.removeClass('alert alert-success')
      errorBag.removeClass('alert alert-danger')
    })
    // Уведомление об успешном заполнении формы
    $(document).on('af_complete', () => {

      AjaxForm.Message.error = (message, sticky) => {

        errorBag.addClass('alert alert-danger')
        errorBag.html('<li style="list-style: none">' + message + '</li>')
      }

      AjaxForm.Message.success = (message, sticky) => {

        successBag.addClass('alert alert-success')
        successBag.html('<li style="list-style: none">' + message + '</li>')
      }
    })
  </script>
</div>

<!-- ДРУГИЕ УСЛОВИЯ ДЛЯ КОРПОРАТИВНЫХ КЛИЕНТОВ -->
<div class="container-xxl">
  <h2>Условия для корпоративных клиентов</h2>
  <div class="row mt-2">
    <span class="col-lg-8 d-flex align-items-end" style="font-size: 18px;">Наша компания специализируется на разработке
      курсов для бизнеса.
      Больше
      информации о сотрудничестве вы можете посмотреть на отдельной странице, жмите кнопку "Подробнее"</span>
    <div class="col-lg-4 d-sm-flex mt-4">
      <div class="d-flex">
        <a href="[[~98]]" type="button"
          class="col-lg-2 btn btn-primary w-100" type="submit">
          Подробнее
        </a>
      </div>
      <div class="position-relative d-sm-block d-none">
        <img class="corporate-arrow" src="/images/arrow_corporate_client.svg" alt="">
      </div>
    </div>
  </div>
</div>


<!-- FAQ -->
<div class="faq py-4 container-xxl">
  <h2>
    Часто задаваемые вопросы
  </h2>
  <div class="row split">
    {set $rows = json_decode($_modx->resource.faq_migx, true)}
    {foreach $rows as $row}
    <div class="list FAQ__hidden">
      <h5 style="font-size: 20px;">{$row.question}</h5>
      <h6 class="font-size:18px">{$row.answer_text}</h6>
      <img class="list__collapse-comment" src="/assets/icons/pages/courses/comment-collapse-arrow.svg" alt="^">
    </div>
    {/foreach}
  </div>
</div>